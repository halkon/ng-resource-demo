#!/bin/bash
PROTRACTOR_PATH="./node_modules/protractor/bin"

ENVIRONMENT=$1

if [ -z $ENVIRONMENT ]; then
    echo 'No Environment Found'
    exit -1
fi

# Let's set up the necessary things for testing
npm install --loglevel=warn


# Let's get the credentials
cp ~/secrets.js ./test/secrets.js

$PROTRACTOR_PATH/webdriver-manager update --standalone
$PROTRACTOR_PATH/webdriver-manager start --standalone 2> /dev/null 1> /dev/null &

# wait for selenium server to actually come up
sleep 5

echo "Running tests..."
CONF="test/conf/protractor.e2e.conf.js"

if [ $ENVIRONMENT == "preprod" ]; then
    CONF="test/conf/protractor.preprod.conf.js"
fi

$PROTRACTOR_PATH/protractor $CONF